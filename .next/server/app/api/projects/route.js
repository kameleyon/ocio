"use strict";(()=>{var e={};e.id=871,e.ids=[871],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},25528:e=>{e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},41808:e=>{e.exports=require("net")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},24404:e=>{e.exports=require("tls")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},54345:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>q,originalPathname:()=>b,patchFetch:()=>x,requestAsyncStorage:()=>w,routeModule:()=>m,serverHooks:()=>j,staticGenerationAsyncStorage:()=>y,staticGenerationBailout:()=>_});var o={};r.r(o),r.d(o,{GET:()=>f,POST:()=>g});var i=r(95419),a=r(69108),s=r(99678),n=r(78070),c=r(81664),u=r(32455),d=r(20967),l=r(42094),p=r(86382),h=r(16758);let f=(0,p.b)((0,h.er)(async e=>{let t=(0,u.cookies)(),r=(0,c.e)(t),{data:{session:o}}=await r.auth.getSession();if(!o)throw p.M.unauthorized("Authentication required");let i=await (0,d.r)(o.user.id);return n.Z.json(i)})),g=(0,p.b)((0,h.er)(async e=>{let t=(0,u.cookies)(),r=(0,c.e)(t),{data:{session:o}}=await r.auth.getSession();if(!o)throw p.M.unauthorized("Authentication required");let{prompt:i}=await e.json();if(!i)throw p.M.badRequest("Prompt is required");let{data:a,error:s}=await r.from("profiles").select("subscription_tier, generation_count").eq("id",o.user.id).single();if(s)throw p.M.internal("Error fetching user profile");if((!a.subscription_tier||"free"===a.subscription_tier)&&a.generation_count>=5)throw p.M.forbidden("Generation limit reached for free tier",{code:"LIMIT_REACHED",meta:{limitReached:!0,tier:"free",upgradeUrl:"/pricing"}});let d=await (0,l.lv)(i),{data:h,error:f}=await r.from("projects").insert([{user_id:o.user.id,name:d,description:i,prompt:i,status:"pending",tech_stack:{}}]).select().single();if(f)throw p.M.internal("Error creating project");await r.rpc("increment_generation_count",{user_id:o.user.id});let g=h.id;return await r.from("projects").update({status:"generating"}).eq("id",g),setTimeout(async()=>{try{let t=await (0,l.bh)(i);await r.from("projects").update({name:t.name,description:t.description,tech_stack:t.techStack,structure:t.structure,status:"completed",download_url:`/api/projects/${g}/download`}).eq("id",g),await r.rpc("add_audit_log",{p_user_id:o.user.id,p_action:"create",p_entity_type:"project",p_entity_id:g,p_details:{prompt:i},p_ip_address:e.headers.get("x-forwarded-for")||e.headers.get("x-real-ip")})}catch(e){console.error("Error in background generation:",e),await r.from("projects").update({status:"failed",tech_stack:{error:e.message}}).eq("id",g)}},1e3),n.Z.json(h)},{limit:10,window:3600,message:"You can only create 10 projects per hour. Please try again later."})),m=new i.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/projects/route",pathname:"/api/projects",filename:"route",bundlePath:"app/api/projects/route"},resolvedPagePath:"c:\\Users\\Administrator\\ocio\\app\\api\\projects\\route.ts",nextConfigOutput:"standalone",userland:o}),{requestAsyncStorage:w,staticGenerationAsyncStorage:y,serverHooks:j,headerHooks:q,staticGenerationBailout:_}=m,b="/api/projects/route";function x(){return(0,s.patchFetch)({serverHooks:j,staticGenerationAsyncStorage:y})}},20967:(e,t,r)=>{r.d(t,{Y:()=>a,r:()=>s});let o=(0,r(46874).AY)("https://cfovctpyutyvyqzvypwx.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNmb3ZjdHB5dXR5dnlxenZ5cHd4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ5MTk0MDIsImV4cCI6MjA2MDQ5NTQwMn0.J-c-JGblGgP4zi5ceTORCq8MYbdfcbtP-Ml8a8s4oRM");var i=r(42094);class a{async createProject(e,t){try{let r=await (0,i.lv)(t),{data:a,error:s}=await o.from("projects").insert([{user_id:e,name:r,description:t,prompt:t,status:"pending",tech_stack:{}}]).select().single();if(s)throw s;return this.generateFullProject(a.id,t),a}catch(e){return console.error("Error creating project:",e),null}}async generateFullProject(e,t){try{await o.from("projects").update({status:"generating"}).eq("id",e);let r=await (0,i.bh)(t);await o.from("projects").update({name:r.name,description:r.description,tech_stack:r.techStack,structure:r.structure}).eq("id",e);let a=await (0,i.iq)(t,r),s=await (0,i.d6)(r.name,a);console.log(`Generated ${a.length} files for project ${r.name}`);let n=Date.now(),c=r.name.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,""),u=`project-zips/${e}/${n}-${c}.zip`,{error:d}=await o.storage.from("project-files").upload(u,s,{contentType:"application/zip",upsert:!0});if(d)throw d;let{data:l}=o.storage.from("project-files").getPublicUrl(u);await o.from("projects").update({status:"completed",download_url:l.publicUrl,files:a.map(e=>e.path)}).eq("id",e)}catch(t){console.error("Error generating full project:",t),await o.from("projects").update({status:"failed"}).eq("id",e)}}async getUserProjects(){try{let{data:e}=await o.auth.getSession();if(!e.session)throw Error("Authentication required");let t=e.session.user.id,{data:r,error:i}=await o.from("projects").select("*").eq("user_id",t).order("created_at",{ascending:!1});if(i)throw i;return r||[]}catch(e){return console.error("Error fetching projects:",e),[]}}static async getProjectsByUserId(e){try{let{data:t,error:r}=await o.from("projects").select("*").eq("user_id",e).order("created_at",{ascending:!1});if(r)throw r;return t||[]}catch(e){return console.error("Error fetching projects by user ID:",e),[]}}async getProjectById(e){try{let{data:t,error:r}=await o.from("projects").select("*").eq("id",e).single();if(r)throw r;return t}catch(e){return console.error("Error fetching project:",e),null}}async downloadProject(e){try{let t=await this.getProjectById(e);if(!t||!t.download_url)throw Error("Project or download URL not found");return window.open(t.download_url,"_blank"),!0}catch(e){return console.error("Error downloading project:",e),!1}}async deleteProject(e){try{let t=`project-zips/${e}`,{data:r}=await o.storage.from("project-files").list(t);if(r&&r.length>0){let e=r.map(e=>`${t}/${e.name}`);await o.storage.from("project-files").remove(e)}let{error:i}=await o.from("projects").delete().eq("id",e);if(i)throw i;return!0}catch(e){return console.error("Error deleting project:",e),!1}}async regenerateProject(e){try{let t=await this.getProjectById(e);if(!t)throw Error("Project not found");return await o.from("projects").update({status:"generating"}).eq("id",e),this.generateFullProject(e,t.prompt),!0}catch(e){return console.error("Error regenerating project:",e),!1}}async getProjectFiles(e){try{let t=await this.getProjectById(e);if(!t)throw Error("Project not found");if("completed"!==t.status)return[];return(0,i.eU)({name:t.name,description:t.description,techStack:t.tech_stack,files:t.files||[],structure:t.structure||[]})}catch(e){return console.error("Error getting project files:",e),[]}}async incrementUserGenerationCount(e){try{let{error:t}=await o.rpc("increment_generation_count",{user_id:e});if(t)throw t;return!0}catch(e){return console.error("Error incrementing generation count:",e),!1}}}async function s(e){return a.getProjectsByUserId(e)}},81664:(e,t,r)=>{r.d(t,{K:()=>s,e:()=>a});var o=r(46874),i=r(32455);function a(e){return(0,o.lx)(process.env.SUPABASE_URL,process.env.SUPABASE_ANON_KEY,{cookies:{get:t=>e.get(t)?.value,set(t,r,o){e.set({name:t,value:r,...o})},remove(t,r){e.set({name:t,value:"",...r})}}})}function s(){return a((0,i.cookies)())}},86382:(e,t,r)=>{r.d(t,{M:()=>i,b:()=>a});var o=r(78070);class i extends Error{constructor(e,t=500,r){super(e),this.name="ApiError",this.statusCode=t,this.details=r}static badRequest(e="Bad Request",t){return new i(e,400,t)}static unauthorized(e="Unauthorized",t){return new i(e,401,t)}static forbidden(e="Forbidden",t){return new i(e,403,t)}static notFound(e="Not Found",t){return new i(e,404,t)}static methodNotAllowed(e="Method Not Allowed",t){return new i(e,405,t)}static tooManyRequests(e="Too Many Requests",t){return new i(e,429,t)}static internal(e="Internal Server Error",t){return new i(e,500,t)}static fromError(e){return e?.code==="PGRST116"?i.notFound("Resource not found"):e?.code==="23505"?i.badRequest("Duplicate entry",{code:e.code}):e?.code?.startsWith("22")?i.badRequest("Invalid input syntax",{code:e.code}):e?.code?.startsWith("23")?i.badRequest("Constraint violation",{code:e.code}):e?.status===401?i.unauthorized(e.message||"Authentication failed"):e?.status===403?i.forbidden(e.message||"Permission denied"):i.internal()}toResponse(){let e={error:{message:this.message,statusCode:this.statusCode,...this.details&&{details:this.details}}};return o.Z.json(e,{status:this.statusCode})}}function a(e){return async(...t)=>{try{return await e(...t)}catch(e){if(console.error("API Error:",e),e instanceof i)return e.toResponse();return i.fromError(e).toResponse()}}}},16758:(e,t,r)=>{r.d(t,{er:()=>d});var o=r(81664),i=r(32455),a=r(86382);let s={anonymous:{limit:30,window:60},free:{limit:60,window:60},pro:{limit:300,window:60},enterprise:{limit:1e3,window:60}},n={};async function c(e){let t=(0,i.cookies)(),r=(0,o.e)(t);try{let{data:{session:e}}=await r.auth.getSession();if(e?.user){let{data:t}=await r.from("profiles").select("subscription_tier").eq("id",e.user.id).single();return{...s[t?.subscription_tier||"free"],useUserIdWhenAvailable:!0}}}catch(e){console.error("Error getting rate limit config:",e)}return s.anonymous}async function u(e,t){let r;let s={...await c(e),...t};if(s.keyGenerator)r=s.keyGenerator(e);else if(r=e.headers.get("x-forwarded-for")||e.headers.get("x-real-ip")||"127.0.0.1",s.useUserIdWhenAvailable){let e=(0,i.cookies)(),t=(0,o.e)(e);try{let{data:{session:e}}=await t.auth.getSession();e?.user&&(r=`user_${e.user.id}`)}catch(e){console.error("Error getting user ID for rate limiting:",e)}}n[r]||(n[r]=[]);let u=Date.now(),d=1e3*s.window;if(n[r]=n[r].filter(e=>u-e<d),n[r].length>=s.limit){let e=Math.min(...n[r])+d,t=Math.ceil((e-u)/1e3),o=new Headers;throw o.set("X-RateLimit-Limit",s.limit.toString()),o.set("X-RateLimit-Remaining","0"),o.set("X-RateLimit-Reset",Math.ceil(e/1e3).toString()),o.set("Retry-After",t.toString()),a.M.tooManyRequests(s.message||`Rate limit exceeded. Try again in ${t} seconds.`,{meta:{retryAfter:t}})}n[r].push(u);let l=new Headers;return l.set("X-RateLimit-Limit",s.limit.toString()),l.set("X-RateLimit-Remaining",(s.limit-n[r].length).toString()),l}function d(e,t){return async(...r)=>{let o=r[0];try{let i=await u(o,t),a=await e(...r);return i.forEach((e,t)=>{a.headers.set(t,e)}),a}catch(e){if(e instanceof a.M&&429===e.statusCode)return e.toResponse();throw e}}}setInterval(()=>{let e=Date.now();Object.keys(n).forEach(t=>{n[t]=n[t].filter(t=>e-t<36e5),0===n[t].length&&delete n[t]})},3e5)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[638,246,455,874,847,94],()=>r(54345));module.exports=o})();